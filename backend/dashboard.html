<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BSFM Quantum Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
      margin: 0;
      padding: 2rem;
      overflow-x: hidden;
    }
    .dashboard {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 1.5rem;
    }
    .card {
      flex: 0 0 320px;
      background-color: #1e293b;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.3s ease;
    }
    .card:hover {
      transform: scale(1.03);
    }
    h1 {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 2rem;
      color: #38bdf8;
    }
    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #7dd3fc;
    }
    .label {
      font-weight: 500;
      color: #94a3b8;
    }
    .value {
      font-size: 1.25rem;
      font-weight: bold;
      color: #f8fafc;
    }
  </style>
</head>
<body>
  <h1>üß† BSFM Quantum Dashboard</h1>
  <div class="dashboard">
    <div id="status" class="card">
      <h3>Service Status</h3>
      <p class="label">Status:</p><p id="statusText" class="value">Loading...</p>
      <p class="label">Uptime:</p><p id="uptimeText" class="value">--</p>
    </div>

    <div id="wallets" class="card">
      <h3>üí∞ Wallet Balances</h3>
      <div id="walletList">
        <p class="label">Loading...</p>
      </div>
    </div>

    <div id="logs" class="card">
      <h3>üìú System Logs</h3>
      <pre id="logText" class="text-sm text-slate-400 whitespace-pre-wrap">Loading logs...</pre>
    </div>

    <div id="products" class="card">
      <h3>üõçÔ∏è Shopify Products</h3>
      <div id="productList"><p class="label">Loading...</p></div>
    </div>

    <div id="bitcoin" class="card">
      <h3>‚Çø Bitcoin Price</h3>
      <p class="label">USD:</p><p id="btcPrice" class="value">--</p>
    </div>
  </div>

  <script>
    async function fetchData(url, onSuccess, onError) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        onSuccess(data);
      } catch (err) {
        console.error(`Fetch error from ${url}:`, err);
        onError(err);
      }
    }

    function renderStatus(data) {
      document.getElementById('statusText').textContent = data.status || 'Unknown';
      document.getElementById('uptimeText').textContent = data.uptime ? `${data.uptime.toFixed(2)}s` : '--';
    }

    function renderWallets(data) {
      const walletList = document.getElementById('walletList');
      walletList.innerHTML = '';
      const chains = ['ethereum', 'solana', 'bwaezi'];
      const symbols = { ethereum: 'ETH', solana: 'SOL', bwaezi: 'bwzC' };

      chains.forEach(chain => {
        const balance = data[chain];
        if (balance) {
          const div = document.createElement('div');
          div.innerHTML = `
            <p class="label">${chain.toUpperCase()} (${symbols[chain]}):</p>
            <p class="value">${balance.native} ${symbols[chain]}</p>
            <p class="label text-xs">USDT: ${balance.usdt || 0}</p>
          `;
          walletList.appendChild(div);
        }
      });
    }

    function renderLogs(data) {
      const logText = document.getElementById('logText');
      logText.textContent = Array.isArray(data.logs) ? data.logs.join('\n') : (data.message || 'No logs available.');
    }

    function renderProducts(data) {
      const productList = document.getElementById('productList');
      productList.innerHTML = '';
      if (Array.isArray(data.products)) {
        data.products.forEach(p => {
          const div = document.createElement('div');
          div.innerHTML = `<p class="value">${p.name}</p><p class="label text-sm">${p.price}</p>`;
          productList.appendChild(div);
        });
      } else {
        productList.innerHTML = `<p class="label">${data.message || 'No products found.'}</p>`;
      }
    }

    function renderBitcoin(data) {
      const price = data.price;
      document.getElementById('btcPrice').textContent = price ? `$${price.toLocaleString()}` : 'N/A';
    }

    // Fetch all data
    fetchData('/api/health', renderStatus, () => {
      document.getElementById('statusText').textContent = 'Unavailable';
    });

    fetchData('/api/wallet-balances', renderWallets, () => {
      document.getElementById('walletList').innerHTML = '<p class="label">Error loading balances</p>';
    });

    fetchData('/api/logs', renderLogs, () => {
      document.getElementById('logText').textContent = 'Error loading logs';
    });

    fetchData('/api/shopify/products', renderProducts, () => {
      document.getElementById('productList').innerHTML = '<p class="label">Error loading products</p>';
    });

    fetchData('/api/bitcoin-price', renderBitcoin, () => {
      document.getElementById('btcPrice').textContent = 'Error';
    });
  </script>
</body>
</html>
