<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BSFM Quantum Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
      margin: 0;
      padding: 2rem;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 2rem;
      max-width: 90vw;
      margin: 0 auto;
    }
    .card {
      background-color: #1e293b;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.3s ease;
    }
    .card:hover {
      transform: scale(1.02);
    }
    h1 {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 2rem;
      color: #38bdf8;
      text-align: center;
    }
    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #7dd3fc;
    }
    .label {
      font-weight: 500;
      color: #94a3b8;
    }
    .value {
      font-size: 1.25rem;
      font-weight: bold;
      color: #f8fafc;
    }
    .button {
      background-color: #2563eb;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ðŸ§  BSFM Quantum Dashboard</h1>
  <div class="dashboard">
    <div id="agents" class="card">
      <h3>ðŸ§© Active Agents</h3>
      <ul id="agentList"><li class="label">Loading...</li></ul>
    </div>

    <div id="sovereignBrain" class="card">
      <h3>ðŸ§  Sovereign Brain Activity</h3>
      <div id="brainActivity"><p class="label">Loading...</p></div>
    </div>

    <div id="revenueEngine" class="card">
      <h3>ðŸ’¸ Revenue Engine</h3>
      <div id="revenueActivity"><p class="label">Loading...</p></div>
    </div>

    <div id="wallets" class="card">
      <h3>ðŸ’° Wallet Control</h3>
      <div id="walletList"><p class="label">Loading...</p></div>
      <button class="button" onclick="sendFunds()">Send Funds</button>
    </div>

    <div id="consolidation" class="card">
      <h3>ðŸ”— Multi-Chain Consolidation</h3>
      <div id="consolidationStatus"><p class="label">Loading...</p></div>
      <button class="button" onclick="triggerConsolidation()">Trigger Consolidation</button>
    </div>
  </div>

  <script>
    async function fetchData(url, onSuccess, onError) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        onSuccess(data);
      } catch (err) {
        console.error(`Fetch error from ${url}:`, err);
        onError(err);
      }
    }

    function renderAgents(data) {
      const agentList = document.getElementById('agentList');
      agentList.innerHTML = '';
      data.agents.forEach(agent => {
        const li = document.createElement('li');
        li.className = 'value';
        li.textContent = agent;
        agentList.appendChild(li);
      });
    }

    function renderBrain(data) {
      const div = document.getElementById('brainActivity');
      div.innerHTML = `<p class="label">Cycle:</p><p class="value">${data.optimizationCycle}</p>
                       <p class="label">Status:</p><p class="value">${data.status}</p>`;
    }

    function renderRevenue(data) {
      const div = document.getElementById('revenueActivity');
      div.innerHTML = `<p class="label">Treasury:</p><p class="value">$${data.treasury}</p>
                       <p class="label">Monthly Revenue:</p><p class="value">$${data.monthly}</p>`;
    }

    function renderWallets(data) {
      const walletList = document.getElementById('walletList');
      walletList.innerHTML = '';
      Object.entries(data).forEach(([chain, balance]) => {
        const div = document.createElement('div');
        div.innerHTML = `<p class="label">${chain.toUpperCase()}:</p>
                         <p class="value">${balance.native} ${chain}</p>
                         <p class="label text-xs">USDT: ${balance.usdt}</p>`;
        walletList.appendChild(div);
      });
    }

    function renderConsolidation(data) {
      const div = document.getElementById('consolidationStatus');
      div.innerHTML = `<p class="label">Last Run:</p><p class="value">${data.lastRun}</p>
                       <p class="label">Status:</p><p class="value">${data.status}</p>`;
    }

    function sendFunds() {
      fetch('/api/wallet/send', { method: 'POST' })
        .then(res => res.json())
        .then(data => alert(`Funds sent: ${data.txHash}`))
        .catch(err => alert('Error sending funds'));
    }

    function triggerConsolidation() {
      fetch('/api/wallet/consolidate', { method: 'POST' })
        .then(res => res.json())
        .then(data => alert(`Consolidation triggered: ${data.status}`))
        .catch(err => alert('Error triggering consolidation'));
    }

    // Fetch all data
    fetchData('/api/agents', renderAgents, () => {
      document.getElementById('agentList').innerHTML = '<li class="label">Error loading agents</li>';
    });

    fetchData('/api/sovereign-brain', renderBrain, () => {
      document.getElementById('brainActivity').innerHTML = '<p class="label">Error loading brain activity</p>';
    });

    fetchData('/api/revenue-engine', renderRevenue, () => {
      document.getElementById('revenueActivity').innerHTML = '<p class="label">Error loading revenue</p>';
    });

    fetchData('/api/wallet-balances', renderWallets, () => {
      document.getElementById('walletList').innerHTML = '<p class="label">Error loading balances</p>';
    });

    fetchData('/api/wallet/consolidation-status', renderConsolidation, () => {
      document.getElementById('consolidationStatus').innerHTML = '<p class="label">Error loading consolidation status</p>';
    });
  </script>
</body>
</html>
