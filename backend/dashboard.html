<script>
document.addEventListener("DOMContentLoaded", () => {
  loadSovereignBrain();
  loadRevenueEngine();
  loadAgents();
  loadWallets();
  loadConsolidationStatus();

  document.getElementById("transferForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const form = e.target;
    const payload = {
      chain: form.chain.value,
      asset: form.asset.value,
      to: form.to.value,
      amount: form.amount.value
    };

    const res = await fetch("/api/wallet/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    alert(result.success ? `✅ Transfer successful: ${result.txHash}` : `❌ Transfer failed: ${result.error}`);
  });
});

async function loadSovereignBrain() {
  const res = await fetch("/api/sovereign-brain");
  const data = await res.json();
  document.querySelector("[data-status]").textContent = data.status;
  document.querySelector("[data-cycle]").textContent = data.optimizationCycle;
  document.querySelector("[data-entanglement]").textContent = data.entanglementStability;
  document.querySelector("[data-coherence]").textContent = data.realityCoherence;
}

async function loadRevenueEngine() {
  const res = await fetch("/api/revenue-engine");
  const data = await res.json();
  document.querySelector("[data-treasury]").textContent = `$${data.treasury}`;
  document.querySelector("[data-monthly]").textContent = `$${data.monthly}`;
}

async function loadAgents() {
  const res = await fetch("/api/agents");
  const agents = await res.json();
  const list = document.getElementById("agentList");
  list.innerHTML = "";
  agents.forEach(agent => {
    const li = document.createElement("li");
    li.className = "wallet-item";
    li.innerHTML = `<strong>${agent.name}</strong> (${agent.type}) — <span class="text-green-400">${agent.status}</span>`;
    list.appendChild(li);
  });
}

async function loadWallets() {
  const res = await fetch("/api/wallet-balances");
  const wallets = await res.json();
  const list = document.getElementById("walletList");
  list.innerHTML = "";
  Object.entries(wallets).forEach(([chain, balance]) => {
    const div = document.createElement("div");
    div.className = "wallet-item";
    div.innerHTML = `<p class="label">${chain.toUpperCase()}</p><p class="value text-green-400">${balance}</p>`;
    list.appendChild(div);
  });
}

async function loadConsolidationStatus() {
  const res = await fetch("/api/wallet/consolidation-status");
  const data = await res.json();
  document.querySelector("[data-last-run]").textContent = data.lastRun;
  document.querySelector("#consolidation [data-status]").textContent = data.status;
}

async function triggerConsolidation() {
  const res = await fetch("/api/wallet/consolidate", { method: "POST" });
  const result = await res.json();
  alert(`✅ ${result.status} at ${result.timestamp}`);
  loadConsolidationStatus();
}
</script>
